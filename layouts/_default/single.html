{{ define "main" }}
<div class="container">
    
    <!-- Back Link -->
    <a href="{{ "/notes/" | relURL }}" class="back-link">â† Notes</a>
    
    <!-- Title -->
    <h1>{{ .Title }}</h1>
    
    <!-- Metadata -->
    <div class="note-meta">
        {{ if eq .Params.type "source" }}
        <span class="badge badge-source">ğŸ“š Source</span>
        {{ end }}
        <span class="badge badge-{{ .Params.status | default "seeding" }}">
            {{ if eq .Params.status "evergreen" }}ğŸŒ³ Evergreen
            {{ else if eq .Params.status "growing" }}ğŸŒ¿ Growing
            {{ else }}ğŸŒ± Seedling{{ end }}
        </span>
        <span class="date">Created: {{ .Date.Format "Jan 2, 2006" }}</span>
        <span class="date">Updated: {{ .Lastmod.Format "Jan 2, 2006" }}</span>
    </div>
    
    <!-- Tags -->
    {{ with .Params.tags }}
    <div class="tags">
        {{ range . }}
        <a href="{{ printf "/notes/tags/%s/" (urlize .) | relURL }}" class="tag">{{ . }}</a>
        {{ end }}
    </div>
    {{ end }}
    
    <!-- Content -->
    <div class="content">
        {{ .Content }}
    </div>
    
    <!-- Backlinks -->
    {{ $currentPage := . }}
    {{ $backlinks := slice }}
    
    {{ range .Site.RegularPages }}
        {{ $content := .RawContent }}
        {{ if and (ne .Permalink $currentPage.Permalink) (in $content $currentPage.Title) }}
            {{ $backlinks = $backlinks | append . }}
        {{ end }}
    {{ end }}
    
    {{ if gt (len $backlinks) 0 }}
        <div class="backlinks">
            <h3>Linked References</h3>
            <ul>
                {{ range $backlinks }}
                    <li>
                        <span class="wikilink-bracket">[[</span><a href="{{ .RelPermalink }}">{{ .Title }}</a><span class="wikilink-bracket">]]</span>
                        {{ if .Summary }}<p class="summary">{{ .Summary | truncate 100 }}</p>{{ end }}
                    </li>
                {{ end }}
            </ul>
        </div>
    {{ end }}
    
</div>
{{ end }}
